
{{ $id := delimit (shuffle (seq 1 9)) "" }}
{{ $editor_id := printf "editor_%s" $id }}
{{ $code_height := or (.Get "code-height") 360 }}
{{ $height := or (.Get "height") 360}}

<iframe id="iframe_{{$id}}" width="100%" height="100%" style="border: 0px;" scrolling="no" frameborder="0" onload="resizeIframe(this)" srcdoc='
<head>
<script src="/js/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/p5.js"></script>
<script src="/js/ace.min/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/acehelper.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
  

<div id="{{$id}}"  style="max-width: 100%; height: 360px;"> </div>
<br>
<div id="parent_{{$editor_id}}" />

{{$fcodes := split .Inner "\n"}}
{{$scode := delimit $fcodes "\\n" }}


<script type="text/javascript">
  createAceEditor({
    parent :$("#parent_{{$editor_id}}"),
    id:"{{$editor_id}}",
    height:{{$code_height}},
    code:"{{ $scode }}",
    onCodeWillRun:(code)=> 
    {
      $("#{{$id}}").children().remove();
      var scale = {{$height}}/720;
      var mapElement = $("#{{$id}}")
      var height = mapElement.width() * scale;
      
      mapElement.css("height",height);
      return "function setup(){var canvas = createCanvas(" + mapElement.width() +"," + height + ");canvas.parent(\"{{$id}}\");" + code + "}";
    },
    onCodeRunEnd : ()=>{new p5();}
  })
</script>
</body>' >
</iframe>
<script type="text/javascript">
  ContentFit($("#iframe_{{$id}}"),{{add $height $code_height}});
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
  }
</script>